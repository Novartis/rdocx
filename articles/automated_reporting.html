<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Automated Reporting ‚Ä¢ rdocx</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automated Reporting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rdocx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/automated_reporting.html">Automated Reporting</a></li>
    <li><a class="dropdown-item" href="../articles/generic_report.html">RMarkdown to Docx: Generic Report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Automated Reporting</h1>
            
      

      <div class="d-none name"><code>automated_reporting.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install and load rdocx</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rdocx</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load other required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/" class="external-link">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we demonstrate using the <code>rdocx</code> package
for updating and automatically adding tables and figures in a docx file
with the following workflow:</p>
<ol style="list-style-type: decimal">
<li>The user populates a yml file with the names of tables and figures
to be updated or added.</li>
<li>The user updates the docx report by executing the appropriate
<code>rdocx</code> function in the console and passing the yml file
location as an argument.</li>
<li>The user inspects the docx report to ensure that the tables and
figures have been updated correctly.</li>
</ol>
<p>‚ùó{rdocx} has been developed to work with ‚ÄúGeneric Report‚Äù style
documents, you can find an example at
<code>use_cases/02_automated_reporting/Automated_Reporting_Example.docx</code>.
It assumes that the Word document will have a specific format.
Therefore, unexpected behavior can be found if the following guidelines
are not followed:</p>
<ul>
<li><p>Captions or titles are expected to be on top of figures and
tables</p></li>
<li><p>Captions are expected to be followed by a placeholder/temporary
figure or table</p></li>
</ul>
<p>üí™ {rdocx} currently supports <strong>.csv</strong> format for tables
and <strong>.jpeg, .png, .bmp</strong> and <strong>.pdf</strong> for
figures.</p>
</div>
<div class="section level2">
<h2 id="writing-the-yml-file">1. Writing the yml file<a class="anchor" aria-label="anchor" href="#writing-the-yml-file"></a>
</h2>
<p>In the <code>rdocx</code> package, you can find an example of a yml
file here:
<code>use_cases/02_automated_reporting/example_yml_1</code></p>
<p>The yml file should have a predefined structure and parameters to be
set:</p>
<ul>
<li><p><code>type</code>. Indicates if it is a table (TBL) or a figure
(FIG)</p></li>
<li><p><code>title</code>. The title or caption of the table/figure in
the template docx file. This will be used to search for the figure/table
in the template docx document, and it will remain the same in the
updated docx document.</p></li>
<li><p><code>file</code>. The name of the file (csv or image) to be used
in the new version of the docx.</p></li>
<li><p><code>widths</code>. For tables only, a pre-defined column widths
(useful for model parameter table, for example).</p></li>
<li><p><code>occurrence</code>. Integer. To be used when captions are
duplicated for more than one figure/table to define the order they
appear in the docx document.</p></li>
</ul>
<p>Below is an example of the yaml structure:</p>
<pre><code><span><span class="va">output_1</span><span class="op">:</span> </span>
<span>  <span class="va">type</span><span class="op">:</span> <span class="va">TBL</span> </span>
<span>  <span class="va">title</span><span class="op">:</span> <span class="st">"Caption of the output 1"</span> </span>
<span>  <span class="va">file</span><span class="op">:</span> <span class="va">output_1.csv</span> </span>
<span></span>
<span><span class="va">output_2</span><span class="op">:</span> </span>
<span>  <span class="va">type</span><span class="op">:</span> <span class="va">FIG</span> </span>
<span>  <span class="va">title</span><span class="op">:</span> <span class="st">"Caption of the output 2"</span> </span>
<span>  <span class="va">file</span><span class="op">:</span> <span class="va">output_2.png</span></span>
<span>  </span>
<span><span class="va">output_3</span><span class="op">:</span> </span>
<span>  <span class="va">type</span><span class="op">:</span> <span class="va">TBL</span> </span>
<span>  <span class="va">title</span><span class="op">:</span> <span class="st">"Caption of the output 3"</span> </span>
<span>  <span class="va">file</span><span class="op">:</span> <span class="va">output_3.csv</span></span>
<span>  <span class="va">widths</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span><span class="op">)</span></span>
<span>  <span class="va">occurrence</span><span class="op">:</span> <span class="fl">1</span></span>
<span>  </span>
<span><span class="va">output_4</span><span class="op">:</span> </span>
<span>  <span class="va">type</span><span class="op">:</span> <span class="va">TBL</span> </span>
<span>  <span class="va">title</span><span class="op">:</span> <span class="st">"Caption of the output 3"</span> </span>
<span>  <span class="va">file</span><span class="op">:</span> <span class="va">output_4.csv</span></span>
<span>  <span class="va">occurrence</span><span class="op">:</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="updating-the-docx-report">2. Updating the docx report<a class="anchor" aria-label="anchor" href="#updating-the-docx-report"></a>
</h2>
<div class="section level3">
<h3 id="replace-outputs-class">Replace Outputs Class<a class="anchor" aria-label="anchor" href="#replace-outputs-class"></a>
</h3>
<p>To update figures and tables in a docx document, the
<code>rdocx</code> class <code>ReplaceOutputs</code> should be used.
Each attribute of the class has a restricted set of entries that are
checked once the input is provided. For example, the class will make
sure that the files passed as attributes exist and that they have the
correct extension.</p>
<p>There are four parameter that the user has to define:</p>
<ul>
<li><p><code>template_docx_filename</code>: String. File name of the
docx file that should be updated. For example,
‚Äú/path/to/file/filename.docx‚Äù</p></li>
<li><p><code>outputs_path</code>: String. Path to the folder with the
outputs (figures and tables-csvs) that will be added to the new version
of the docx</p></li>
<li><p><code>doc_final_filename</code>: String. File name of the updated
version of the docx file. For example,
‚Äú/path/to/file/filename_updated.docx‚Äù</p></li>
<li><p><code>yml_filename</code>: String. File name of the yml file that
will guide the replacement of the outputs (tables and figures) in the
updated docx file. For example, ‚Äú/path/to/file/filename.yml‚Äù</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span> <span class="op">&lt;-</span> <span class="fu">rdocx</span><span class="fu">::</span><span class="va"><a href="../reference/ReplaceOutputs.html">ReplaceOutputs</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  template_docx_filename <span class="op">=</span> <span class="st">"/path/to/file/filename.docx"</span>,</span>
<span>  outputs_path <span class="op">=</span> <span class="st">"path/to/outputs"</span>,</span>
<span>  doc_final_filename <span class="op">=</span> <span class="st">"./updated_filename.docx"</span>,</span>
<span>  yml_filename <span class="op">=</span> <span class="st">"/path/to/file/filename.yml"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span> <span class="op">&lt;-</span> <span class="fu">rdocx</span><span class="fu">::</span><span class="va"><a href="../reference/ReplaceOutputs.html">ReplaceOutputs</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  template_docx_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting"</span>,</span>
<span>    <span class="st">"Automated_Reporting_Example.docx"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting/example_outputs"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  doc_final_filename <span class="op">=</span>  <span class="st">"./test.docx"</span>,</span>
<span>  yml_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting"</span>,</span>
<span>    <span class="st">"example_yml_1.yml"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="automatic-yaml-file-creation">Automatic yaml file creation<a class="anchor" aria-label="anchor" href="#automatic-yaml-file-creation"></a>
</h3>
<p>As explained above, the <code>ReplaceOuptuts</code> class needs a yml
file with a predefined structure as input. This yml file can be created
manually or automatically using <code>get_captions_to_yml()</code>. This
method requires only the location of the automatically created yml file
as input.</p>
<p>To use this functionality, an element of the
<code>ReplaceOuptuts</code> class has to be created first without
defining the <code>yml_filename</code> parameter. After that, the method
can be called, and the new yml file will be created in the specified
location:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span> <span class="op">&lt;-</span> <span class="fu">rdocx</span><span class="fu">::</span><span class="va"><a href="../reference/ReplaceOutputs.html">ReplaceOutputs</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  template_docx_filename <span class="op">=</span> <span class="st">"/path/to/file/filename.docx"</span>,</span>
<span>  outputs_path <span class="op">=</span> <span class="st">"path/to/outputs"</span>,</span>
<span>  doc_final_filename <span class="op">=</span> <span class="st">"./updated_filename.docx"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">uo</span><span class="op">$</span><span class="fu">get_captions_to_yml</span><span class="op">(</span>yml_caption_filename<span class="op">=</span><span class="st">"/path/to/file/filename.yml"</span><span class="op">)</span></span></code></pre></div>
<p>In the background, <code>get_captions_to_yml()</code> scans for all
figures and tables in the docx file and populates the yml file with the
corresponding information (<code>type</code> and <code>title</code>). If
the user defines in the docx file the source of the figure or caption
below the placeholder image or table (‚ÄúSource:‚Äù), it will assign this
information to the <code>file</code> parameter in the yml file.</p>
<p>‚ö†Ô∏è Be sure to specify correctly the path to the source figure or
table. The path will be built joining the outputs paths and the source
path.</p>
<div class="float">
<img src="images%2Fsource_under_caption_example.png" style="width:50.0%" alt="Example of docx document with source defined under figure placeholder."><div class="figcaption">Example of docx document with source defined
under figure placeholder.</div>
</div>
<p>Once the yml file is created, the user can manually add the missing
information if needed (<code>file</code>, <code>widhts</code>,
<code>occurrence</code>). If no <code>file</code> is provided, the
output will be skipped and will remain unchanged.</p>
<p>Finally, this new yml file can be reassigned to the element of
<code>ReplaceOutputs</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span><span class="op">$</span><span class="va">yml_filename</span> <span class="op">&lt;-</span> <span class="st">"/path/to/file/filename.yml"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span> <span class="op">&lt;-</span> <span class="fu">rdocx</span><span class="fu">::</span><span class="va"><a href="../reference/ReplaceOutputs.html">ReplaceOutputs</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  template_docx_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting"</span>,</span>
<span>    <span class="st">"Automated_Reporting_Example.docx"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting/example_outputs"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  doc_final_filename <span class="op">=</span>  <span class="st">"./test.docx"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">uo</span><span class="op">$</span><span class="fu">get_captions_to_yml</span><span class="op">(</span>yml_caption_filename<span class="op">=</span><span class="st">"./test.yml"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uo</span><span class="op">$</span><span class="va">yml_filename</span> <span class="op">&lt;-</span> <span class="st">"./test.yml"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update-all-outputs-at-once">Update all outputs at once<a class="anchor" aria-label="anchor" href="#update-all-outputs-at-once"></a>
</h3>
<p>Once the user has created an element of the
<code>ReplaceOuptuts</code> class, the method
<code>update_all_outputs()</code> can be used to update all the tables
and figures defined in the yml file. No parameters have to be defined
and, in the background, it iterates through all the outputs in the yml
file, and assigns them in the correct location in the updated docx file
with the correct format.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span> <span class="op">&lt;-</span> <span class="fu">rdocx</span><span class="fu">::</span><span class="va"><a href="../reference/ReplaceOutputs.html">ReplaceOutputs</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  template_docx_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting"</span>,</span>
<span>    <span class="st">"Automated_Reporting_Example.docx"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting/example_outputs"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  doc_final_filename <span class="op">=</span>  <span class="st">"./test.docx"</span>,</span>
<span>  yml_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"use_cases/02_automated_reporting"</span>,</span>
<span>    <span class="st">"example_yml_1.yml"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"rdocx"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uo</span><span class="op">$</span><span class="fu">update_all_outputs</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="inspect-the-updated-docx-report">3. Inspect the updated docx report<a class="anchor" aria-label="anchor" href="#inspect-the-updated-docx-report"></a>
</h2>
<p>You should now have rendered your docx file in the location
<code>doc_final_filename</code>. <strong>Please, review the rendering to
ensure it is as expected.</strong></p>
<div class="section level3">
<h3 id="logging-your-settings-and-session-info">Logging your settings and session info<a class="anchor" aria-label="anchor" href="#logging-your-settings-and-session-info"></a>
</h3>
<p>The <code>update_all_outputs()</code> function also logs information
to aid reproducibility and traceability. The log file will be written to
the same location as the <code>doc_final_filename</code>. The log file
will contain the following information:</p>
<ul>
<li><p>The path to the original and final docx document</p></li>
<li><p>The outputs folder and yml file location</p></li>
<li><p>The name of the figures/tables changed, and the path of the new
figure/table added</p></li>
<li><p>The path from where your R libraries are loaded (i.e.¬†the package
bundle version)</p></li>
<li><p>The R session info provided by
<code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code></p></li>
</ul>
<p>üëÄ If you encounter an error please <a href="ADD%20LINK">raise an
issue</a> for the {rdocx} package team.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Janina Linnik, Orla Doyle, Ines Gimeno Molina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
